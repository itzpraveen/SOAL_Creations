---
import Logo from './Logo.astro';

const currentPath = Astro.url.pathname;

const navLinks = [
    { href: '/', label: 'Index' },
    { href: '/work', label: 'Selected Work' },
    { href: '/services', label: 'Expertise' },
    { href: '/about', label: 'Studio' },
    { href: '/contact', label: 'Contact' }
];

const socialLinks = [
    { href: 'https://wa.me/917034498101', label: 'WhatsApp' },
    { href: 'https://www.instagram.com/soalcollaborations', label: 'Instagram' },
    { href: 'https://www.linkedin.com/company/so%C9%90l-collaborations/', label: 'LinkedIn' }
];
---

<nav class="nav" id="main-nav">
    
    <a href="/" class="logo-link" aria-label="SOAL Creations Home">
        <Logo class="logo-svg" size="medium" />
    </a>

    <ul class="nav-links" id="nav-links">
        {navLinks.map(link => (
            <li>
                <a
                    href={link.href}
                    class:list={[{ active: currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) }]}
                >
                    {link.label}
                </a>
            </li>
        ))}
    </ul>

    <button class="menu-btn" id="menu-btn" aria-label="Toggle menu" aria-expanded="false">
        <span class="menu-icon">
            <span></span>
            <span></span>
        </span>
        <span class="menu-text">Menu</span>
    </button>
</nav>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu" id="mobile-menu" aria-hidden="true">
    <ul class="mobile-nav-links">
        {navLinks.map((link, index) => (
            <li style={`--delay: ${index * 0.1}s`}>
                <a
                    href={link.href}
                    class:list={[{ active: currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) }]}
                >
                    {link.label}
                </a>
            </li>
        ))}
    </ul>
    <div class="mobile-menu-footer">
        <a href="mailto:hello@soalcreations.com">hello@soalcreations.com</a>
        <div class="mobile-socials">
            {socialLinks.map(link => (
                <a href={link.href} target="_blank" rel="noopener" aria-label={link.label}>
                    <span class="social-icon">
                        {link.label === 'WhatsApp' && (
                            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    fill="currentColor"
                                    d="M20.52 3.48A11.78 11.78 0 0 0 12.04 0C5.7 0 .37 5.21.37 11.52c0 2.03.53 4.01 1.55 5.77L0 24l7-1.83a11.9 11.9 0 0 0 5.05 1.12h.01c6.35 0 11.66-5.2 11.66-11.52 0-3.08-1.24-5.98-3.2-8.29ZM12.05 21.3h-.01a9.8 9.8 0 0 1-4.93-1.35l-.35-.2-4.15 1.08 1.11-4.04-.23-.33a9.54 9.54 0 0 1-1.48-5.13c0-5.25 4.32-9.51 9.64-9.51a9.54 9.54 0 0 1 6.79 2.77 9.29 9.29 0 0 1 2.85 6.74c0 5.25-4.32 9.51-9.64 9.51Zm5.39-7.1c-.29-.15-1.71-.84-1.97-.94-.26-.1-.45-.15-.64.15-.19.3-.74.94-.91 1.13-.17.2-.33.22-.62.07-.29-.15-1.22-.44-2.32-1.4-.86-.76-1.44-1.7-1.61-1.99-.17-.3-.02-.45.13-.6.14-.14.29-.35.44-.53.15-.17.2-.3.3-.5.1-.2.05-.37-.02-.53-.07-.15-.64-1.54-.88-2.11-.23-.56-.47-.49-.64-.5-.17-.01-.37-.02-.57-.02-.2 0-.53.07-.81.37-.28.3-1.08 1.04-1.08 2.53 0 1.5 1.11 2.95 1.26 3.15.16.2 2.18 3.34 5.36 4.56.75.29 1.34.46 1.8.59.76.24 1.46.21 2.01.13.61-.09 1.86-.76 2.12-1.49.26-.73.26-1.36.18-1.49-.07-.13-.26-.2-.55-.35Z"
                                />
                            </svg>
                        )}
                        {link.label === 'Instagram' && (
                            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
                                <rect x="3" y="3" width="18" height="18" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="17.5" cy="6.5" r="1.3" fill="currentColor"/>
                            </svg>
                        )}
                        {link.label === 'LinkedIn' && (
                            <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
                                <path fill="currentColor" d="M20.45 20.45h-3.56v-5.18c0-1.24-.02-2.83-1.73-2.83-1.74 0-2.01 1.36-2.01 2.74v5.27H9.59V9h3.42v1.56h.05c.48-.9 1.66-1.84 3.42-1.84 3.66 0 4.34 2.41 4.34 5.55v6.18ZM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12ZM7.12 20.45H3.56V9h3.56v11.45Z"/>
                            </svg>
                        )}
                    </span>
                    {link.label}
                </a>
            ))}
        </div>
    </div>
</div>

<style>
    .nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 1.5rem 2rem;
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        mix-blend-mode: difference;
        color: white;
        transition: padding 0.3s ease;
    }

    .nav.scrolled {
        padding: 1rem 2rem;
    }

    .logo-link {
        display: flex;
        align-items: center;
        text-decoration: none;
        z-index: 1001;
    }

    .logo-svg {
        width: clamp(130px, 16vw, 190px);
        height: auto;
        fill: currentColor;
        transition: transform 0.3s ease;
    }

    .logo-link:hover .logo-svg {
        transform: scale(1.05);
    }

    .nav-links {
        display: flex;
        gap: 2.5rem;
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .nav-links a {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 500;
        opacity: 0.7;
        position: relative;
        padding: 0.25rem 0;
        transition: opacity 0.3s ease;
    }

    .nav-links a::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 1px;
        background: currentColor;
        transition: width 0.3s ease;
    }

    .nav-links a:hover,
    .nav-links a.active {
        opacity: 1;
    }

    .nav-links a:hover::after,
    .nav-links a.active::after {
        width: 100%;
    }

    .menu-btn {
        display: none;
        align-items: center;
        gap: 0.75rem;
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        padding: 0.5rem;
        z-index: 1001;
        font-family: inherit;
    }

    .menu-icon {
        display: flex;
        flex-direction: column;
        gap: 6px;
        width: 24px;
    }

    .menu-icon span {
        display: block;
        height: 1.5px;
        background: currentColor;
        transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .menu-icon span:first-child {
        width: 100%;
    }

    .menu-icon span:last-child {
        width: 60%;
    }

    .menu-btn.active .menu-icon span:first-child {
        transform: rotate(45deg) translate(5px, 5px);
    }

    .menu-btn.active .menu-icon span:last-child {
        transform: rotate(-45deg) translate(3px, -3px);
        width: 100%;
    }

    .menu-text {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 500;
    }

    /* Mobile Menu Overlay */
    .mobile-menu {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        height: 100dvh;
        background: var(--bg-color, #080808);
        z-index: 999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 6rem 2rem 2rem;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s ease, visibility 0.4s ease;
    }

    .mobile-menu.active {
        opacity: 1;
        visibility: visible;
    }

    .mobile-nav-links {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .mobile-nav-links li {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s ease, transform 0.4s ease;
        transition-delay: var(--delay, 0s);
    }

    .mobile-menu.active .mobile-nav-links li {
        opacity: 1;
        transform: translateY(0);
    }

    .mobile-nav-links a {
        display: block;
        font-size: clamp(2rem, 8vw, 3.5rem);
        font-weight: 300;
        padding: 0.75rem 0;
        color: var(--text-primary, #F2F2F2);
        opacity: 0.6;
        transition: opacity 0.3s ease, padding-left 0.3s ease;
    }

    .mobile-nav-links a:hover,
    .mobile-nav-links a.active {
        opacity: 1;
        padding-left: 1rem;
    }

    .mobile-menu-footer {
        margin-top: auto;
        padding-top: 2rem;
        border-top: 1px solid var(--border-light, rgba(255,255,255,0.1));
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s ease 0.5s, transform 0.4s ease 0.5s;
    }

    .mobile-menu.active .mobile-menu-footer {
        opacity: 1;
        transform: translateY(0);
    }

    .mobile-menu-footer a {
        color: var(--text-secondary, #888);
        font-size: 0.9rem;
    }

    .mobile-menu-footer a:hover {
        color: var(--text-primary, #F2F2F2);
    }

    .mobile-socials {
        display: flex;
        gap: 1.5rem;
        margin-top: 1rem;
        flex-wrap: wrap;
    }

    .mobile-socials a {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        color: var(--text-secondary, #888);
    }

    .mobile-socials a:hover {
        color: var(--text-primary, #F2F2F2);
    }

    .social-icon svg {
        display: block;
    }

    .social-icon {
        display: inline-flex;
        align-items: center;
    }

    @media (max-width: 900px) {
        .nav-links {
            display: none;
        }

        .menu-btn {
            display: flex;
        }

        .logo-svg {
            width: 120px;
        }
    }
</style>

<script>
    // Navigation functionality
    document.addEventListener('DOMContentLoaded', () => {
        const nav = document.getElementById('main-nav');
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        if (!menuBtn || !mobileMenu || !nav) return;

        // Toggle mobile menu
        menuBtn.addEventListener('click', () => {
            const isActive = mobileMenu.classList.contains('active');

            mobileMenu.classList.toggle('active');
            menuBtn.classList.toggle('active');
            menuBtn.setAttribute('aria-expanded', String(!isActive));
            mobileMenu.setAttribute('aria-hidden', String(isActive));

            // Prevent body scroll when menu is open
            document.body.style.overflow = isActive ? '' : 'hidden';
        });

        // Close menu on link click
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
                menuBtn.classList.remove('active');
                menuBtn.setAttribute('aria-expanded', 'false');
                mobileMenu.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
            });
        });

        // Close menu on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
                mobileMenu.classList.remove('active');
                menuBtn.classList.remove('active');
                menuBtn.setAttribute('aria-expanded', 'false');
                mobileMenu.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
            }
        });

        // Scroll behavior for nav
        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            const currentScroll = window.scrollY;

            if (currentScroll > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }

            lastScroll = currentScroll;
        }, { passive: true });
    });
</script>
