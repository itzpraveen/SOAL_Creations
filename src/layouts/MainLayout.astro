---
import '../styles/global.css';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';

interface Props {
    title: string;
    description?: string;
}

const { title, description = 'A strategic branding and communication studio building the future of identity.' } = Astro.props;
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content={description}>
    <meta name="theme-color" content="#080808">

    <!-- Open Graph -->
    <meta property="og:title" content={`${title} | SOAL Creations`}>
    <meta property="og:description" content={description}>
    <meta property="og:type" content="website">

    <title>{title} | SOAL Creations</title>

    <!-- Preload critical assets -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" is:inline></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" is:inline></script>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <Navigation />

    <main id="main-content">
        <slot />
    </main>

    <Footer />
</body>
</html>

<script is:inline>
    // Global Animations & Interactions
    document.addEventListener('DOMContentLoaded', () => {
        // Check for reduced motion preference
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        if (prefersReducedMotion) return;

        if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
            gsap.registerPlugin(ScrollTrigger);

            // Smooth reveal animations for content elements
            const revealElements = document.querySelectorAll(
                '.manifesto h2, .stat, .project, .service-item, .descriptor'
            );

            revealElements.forEach((el, index) => {
                gsap.from(el, {
                    y: 40,
                    opacity: 0,
                    duration: 0.8,
                    ease: 'power3.out',
                    scrollTrigger: {
                        trigger: el,
                        start: 'top 85%',
                        toggleActions: 'play none none none'
                    }
                });
            });

            // Parallax effect for hero background
            const heroBg = document.querySelector('.hero-bg');
            if (heroBg) {
                gsap.to(heroBg, {
                    yPercent: 30,
                    ease: 'none',
                    scrollTrigger: {
                        trigger: '.hero',
                        start: 'top top',
                        end: 'bottom top',
                        scrub: true
                    }
                });
            }

            // Project image reveal
            const projectImages = document.querySelectorAll('.project-img');
            projectImages.forEach(img => {
                gsap.from(img, {
                    scale: 1.1,
                    opacity: 0.5,
                    duration: 1,
                    ease: 'power2.out',
                    scrollTrigger: {
                        trigger: img,
                        start: 'top 80%',
                        toggleActions: 'play none none none'
                    }
                });
            });

            // Staggered service items
            const serviceItems = document.querySelectorAll('.service-item');
            if (serviceItems.length > 0) {
                gsap.from(serviceItems, {
                    y: 30,
                    opacity: 0,
                    duration: 0.6,
                    stagger: 0.1,
                    ease: 'power2.out',
                    scrollTrigger: {
                        trigger: serviceItems[0],
                        start: 'top 80%',
                        toggleActions: 'play none none none'
                    }
                });
            }

            // Stats counter animation
            const stats = document.querySelectorAll('.stat h3');
            stats.forEach(stat => {
                const text = stat.textContent;
                const hasNumber = /\d+/.test(text);

                if (hasNumber) {
                    const number = parseInt(text.match(/\d+/)[0]);
                    const suffix = text.replace(/\d+/, '');

                    gsap.from(stat, {
                        textContent: 0,
                        duration: 2,
                        ease: 'power2.out',
                        snap: { textContent: 1 },
                        scrollTrigger: {
                            trigger: stat,
                            start: 'top 85%',
                            toggleActions: 'play none none none'
                        },
                        onUpdate: function() {
                            stat.textContent = Math.round(this.targets()[0].textContent) + suffix;
                        }
                    });
                }
            });
        }

        // Smooth cursor follower (optional enhancement)
        const cursor = document.createElement('div');
        cursor.className = 'custom-cursor';
        cursor.innerHTML = '<div class="cursor-dot"></div>';

        // Only add custom cursor on non-touch devices with large screens
        if (window.matchMedia('(pointer: fine) and (min-width: 1024px)').matches) {
            document.body.appendChild(cursor);

            let mouseX = 0, mouseY = 0;
            let cursorX = 0, cursorY = 0;

            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });

            function animateCursor() {
                cursorX += (mouseX - cursorX) * 0.15;
                cursorY += (mouseY - cursorY) * 0.15;
                cursor.style.transform = `translate(${cursorX}px, ${cursorY}px)`;
                requestAnimationFrame(animateCursor);
            }
            animateCursor();

            // Cursor interactions
            const interactiveElements = document.querySelectorAll('a, button, .project');
            interactiveElements.forEach(el => {
                el.addEventListener('mouseenter', () => cursor.classList.add('cursor-hover'));
                el.addEventListener('mouseleave', () => cursor.classList.remove('cursor-hover'));
            });
        }
    });
</script>

<style is:global>
    /* Custom cursor styles */
    .custom-cursor {
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 9999;
        mix-blend-mode: difference;
    }

    .cursor-dot {
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.2s ease, height 0.2s ease, background 0.2s ease;
    }

    .custom-cursor.cursor-hover .cursor-dot {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.3);
    }

    /* Hide default cursor when custom cursor is active */
    @media (pointer: fine) and (min-width: 1024px) {
        body {
            cursor: none;
        }

        a, button, .project {
            cursor: none;
        }
    }
</style>
